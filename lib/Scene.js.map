{"version":3,"sources":["../src/Scene.js"],"names":["Scene","id","opts","canvas","document","getElementById","$canvas","$","ctx","getContext","boxs","layers","reverseLayers","selected","elementContainer","_initElementContainer","elements","infinity","scaleX","scaleY","scale","zoom","offsetX","offsetY","mousedown","originX","originY","doubleTap","tapDistance","_isMobile","on","_onTouchStart","bind","_onTouchMove","_onTouchEnd","_onTouchCancel","_onContainerTouchStart","_onContainerTouchEnd","_onContainerTouchCancel","_onMouseUp","_onMouseDown","_onMouseMove","_onMouseOver","_onMouseOut","_onMouseWheel","_onContainerMouseUp","_onContainerMouseDown","_onContainerMouseOver","_onContainerMouseOut","test","navigator","userAgent","x0","y0","x1","y1","xdiff","ydiff","Math","pow","border_top_width","parseInt","css","border_right_width","border_bottom_width","border_left_width","container","display","overflow","width","height","position","left","offsetLeft","top","offsetTop","pointerEvents","append","box","layer","z","undefined","handle","i","unshift","element","attr","x","y","remove","isElement","show_","render","paths","_getPaths","_include","e","preventDefault","pageX","pageY","_MouseUp","_onSelected","onMouseUp","_MouseDown","onMouseDown","onMouseMove","onTouch","onMouseOver","originalSelected","onMouseOut","from","fromElement","to","toElement","wheelDelta","touches","length","_calcDistance","onTouchStart","diff","onTouchMove","onTouchEnter","onTouchLeave","changedTouches","onTouchEnd","target","v1","setPosition","_addToDom","_addToLayer","scene","mount","_removeFromDom","_removeFromLayer","_removePosition","clear","forEach","_renderOne","clearRect","removeBox"],"mappings":"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","file":"Scene.js","sourcesContent":["import _ from 'lodash';\r\nimport uuid from 'node-uuid';\r\n\r\nimport Context from './Context';\r\n\r\nexport default class Scene{\r\n    constructor(id, opts){\r\n        this.canvas = document.getElementById(id);\r\n        this.$canvas = $(this.canvas);\r\n        this.ctx = this.canvas.getContext('2d');\r\n        this.boxs = {};\r\n        this.layers = [];\r\n        this.reverseLayers = [];\r\n        this.selected = null;\r\n        this.elementContainer = this._initElementContainer();\r\n        this.elements = {};\r\n\r\n        // Options\r\n        this.opts = opts || {};\r\n        this.infinity = this.opts.infinity || false;\r\n        this.scaleX = this.opts.scaleX || 1;\r\n        this.scaleY = this.opts.scaleY || 1;\r\n        this.ctx.scale(this.scaleX, this.scaleY);\r\n        this.zoom = this.opts.zoom || 1;\r\n\r\n        // Parameters associated with Infinite Canvas\r\n        this.offsetX = 0;\r\n        this.offsetY = 0;\r\n\r\n        // Parameters associated with Mousedown\r\n        this.mousedown = false;\r\n        this.originX = -1;\r\n        this.originY = -1;\r\n\r\n        // Parameters associated with zoom\r\n        this.doubleTap = false;\r\n        this.tapDistance = -1;\r\n\r\n        // Register Event\r\n        if(this._isMobile()){\r\n            this.$canvas.on('touchstart', this._onTouchStart.bind(this));\r\n            this.$canvas.on('touchmove', this._onTouchMove.bind(this));\r\n            this.$canvas.on('touchend', this._onTouchEnd.bind(this));\r\n            this.$canvas.on('touchcancel', this._onTouchCancel.bind(this));\r\n\r\n            this.elementContainer.on('touchstart', '*', this._onContainerTouchStart.bind(this));\r\n            this.elementContainer.on('touchmove', '*', this._onTouchMove.bind(this));\r\n            this.elementContainer.on('touchend', '*', this._onContainerTouchEnd.bind(this));\r\n            this.elementContainer.on('touchcancel', '*', this._onContainerTouchCancel.bind(this));\r\n        } else {\r\n            this.$canvas.on('mouseup', this._onMouseUp.bind(this));\r\n            this.$canvas.on('mousedown', this._onMouseDown.bind(this));\r\n            this.$canvas.on('mousemove', this._onMouseMove.bind(this));\r\n            this.$canvas.on('mouseover', this._onMouseOver.bind(this));\r\n            this.$canvas.on('mouseout', this._onMouseOut.bind(this));\r\n            this.$canvas.on('mousewheel', this._onMouseWheel.bind(this));\r\n\r\n            this.elementContainer.on('mouseup', '*', this._onContainerMouseUp.bind(this));\r\n            this.elementContainer.on('mousedown', '*', this._onContainerMouseDown.bind(this));\r\n            this.elementContainer.on('mousemove', '*', this._onMouseMove.bind(this));\r\n            this.elementContainer.on('mouseover', '*', this._onContainerMouseOver.bind(this));\r\n            this.elementContainer.on('mouseout', '*', this._onContainerMouseOut.bind(this));\r\n            this.elementContainer.on('mousewheel', '*', this._onMouseWheel.bind(this));\r\n        }\r\n    }\r\n\r\n    _isMobile(){\r\n        // return true;\r\n        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\r\n    }\r\n\r\n    _calcDistance(x0, y0, x1, y1){\r\n        let xdiff = x1 - x0;\r\n        let ydiff = y1 - y0;\r\n        return Math.pow(xdiff * xdiff + ydiff * ydiff, 0.5);\r\n    }\r\n\r\n    _initElementContainer(){\r\n        let border_top_width = parseInt(this.$canvas.css('border-top-width'));\r\n        let border_right_width = parseInt(this.$canvas.css('border-right-width'));\r\n        let border_bottom_width = parseInt(this.$canvas.css('border-bottom-width'));\r\n        let border_left_width = parseInt(this.$canvas.css('border-left-width'));\r\n        let container = $('<div />');\r\n        container.css({\r\n            display: 'inline-block',\r\n            overflow: 'hidden',\r\n            width: this.$canvas.width() - border_left_width - border_right_width,\r\n            height: this.$canvas.height() - border_top_width - border_bottom_width,\r\n            position: 'absolute',\r\n            left: this.canvas.offsetLeft + border_left_width,\r\n            top: this.canvas.offsetTop + border_top_width,\r\n            pointerEvents: 'none'\r\n        });\r\n        $('body').append(container);\r\n        return container;\r\n    }\r\n\r\n    _addToLayer(box){\r\n        let layer = this.layers[box.z];\r\n        if(layer == undefined){\r\n            layer = {};\r\n            this.layers[box.z] = layer;\r\n        }\r\n        layer[box.handle] = box;\r\n        this.reverseLayers = [];\r\n        for(var i in this.layers){\r\n            this.reverseLayers.unshift(this.layers[i]);\r\n        }\r\n    }\r\n\r\n    _addToDom(box){\r\n        this.elements[box.handle] = box;\r\n        box.element.attr('handle', box.handle);\r\n        box.element.css('pointer-events', 'auto');\r\n        box.element.css('display', 'inline-block');\r\n        box.element.css('position', 'absolute');\r\n        box.element.css('left', box.x);\r\n        box.element.css('top', box.y);\r\n        this.elementContainer.append(box.element);\r\n    }\r\n\r\n    _removeFromLayer(box){\r\n        let layer = this.layers[box.z];\r\n        if(layer != undefined){\r\n            delete layer[box.handle];\r\n        }\r\n    }\r\n\r\n    _removeFromDom(box){\r\n        box.element.remove();\r\n        delete this.elements[box.handle];\r\n    }\r\n\r\n    _renderOne(box){\r\n        if(box.isElement){\r\n            if(box.show_){\r\n                box.element.css('display', 'inline-block');\r\n                box.element.css('left', box.x * this.zoom + this.offsetX);\r\n                box.element.css('top', box.y * this.zoom + this.offsetY);\r\n                box.element.css('z-index', box.z);\r\n                box.element.css('transform', `scale(${this.zoom}, ${this.zoom})`);\r\n                box.element.css('transform-origin', 'left top');\r\n            } else {\r\n                box.element.css('display', 'none');\r\n            }\r\n        } else if(box.show_) {\r\n            let ctx = new Context(this.ctx, box.x * this.zoom + this.offsetX, box.y * this.zoom + this.offsetY, this.zoom);\r\n            box.render(ctx);\r\n            box.paths = ctx._getPaths();\r\n        }\r\n    }\r\n\r\n    _onSelected(x, y){\r\n        x = x * this.scaleX;\r\n        y = y * this.scaleY;\r\n        let selected = null;\r\n        for(var i in this.reverseLayers){\r\n            let layer = this.reverseLayers[i];\r\n            for(var handle in layer){\r\n                let box = layer[handle];\r\n                if(box._include(x, y)){\r\n                    selected = box;\r\n                    break;\r\n                }\r\n            }\r\n            if(selected != undefined){\r\n                break;\r\n            }\r\n        }\r\n        return selected;\r\n    }\r\n\r\n    // Methods associated with Mousedown\r\n\r\n    _MouseDown(x, y){\r\n        this.mousedown = true;\r\n        this.originX = x;\r\n        this.originY = y;\r\n    }\r\n\r\n    _MouseUp(){\r\n        this.mousedown = false;\r\n        this.originX = -1;\r\n        this.originY = -1;\r\n    }\r\n\r\n    // Canvas Events\r\n\r\n    _onMouseUp(e){\r\n        e.preventDefault();\r\n        let x = e.pageX - this.canvas.offsetLeft;\r\n        let y = e.pageY - this.canvas.offsetTop;\r\n        this._MouseUp();\r\n        let selected = this._onSelected(x, y);\r\n        if(selected != undefined){\r\n            selected.onMouseUp(e, x / this.zoom, y / this.zoom);\r\n        }\r\n        this.onMouseUp(e, x / this.zoom, y / this.zoom, selected);\r\n    }\r\n\r\n    _onMouseDown(e){\r\n        e.preventDefault();\r\n        let x = e.pageX - this.canvas.offsetLeft;\r\n        let y = e.pageY - this.canvas.offsetTop;\r\n        this._MouseDown(x, y);\r\n        let selected = this._onSelected(x, y);\r\n        if(selected != undefined){\r\n            selected.onMouseDown(e, x / this.zoom, y / this.zoom);\r\n        }\r\n        this.onMouseDown(e, x / this.zoom, y / this.zoom, selected);\r\n    }\r\n\r\n    _onMouseMove(e){\r\n        e.preventDefault();\r\n        let x = e.pageX - this.canvas.offsetLeft;\r\n        let y = e.pageY - this.canvas.offsetTop;\r\n        this.onMouseMove(e, x / this.zoom, y / this.zoom);\r\n        let selected = this._onSelected(x, y);\r\n        if(selected != undefined){\r\n            if(this.selected == undefined || this.selected.handle != selected.handle){\r\n                this.selected = selected;\r\n                this.onTouch(e, x / this.zoom, y / this.zoom, selected);\r\n                selected.onMouseOver(e, x / this.zoom, y / this.zoom);\r\n            }\r\n        } else {\r\n            if(this.selected != undefined){\r\n                let originalSelected = this.selected;\r\n                this.selected = selected;\r\n                this.onTouch(e, x / this.zoom, y / this.zoom, selected);\r\n                originalSelected.onMouseOut(e, x / this.zoom, y / this.zoom);\r\n            }\r\n            if(this.infinity && this.mousedown){\r\n                this.offsetX += x - this.originX;\r\n                this.offsetY += y - this.originY;\r\n                this.originX = x;\r\n                this.originY = y;\r\n                this.render();\r\n            }\r\n        }\r\n    }\r\n\r\n    _onMouseOver(e){\r\n        e.preventDefault();\r\n        let from = $(e.fromElement);\r\n        if(from.attr('handle') in this.elements){\r\n            return;\r\n        }\r\n        let x = e.pageX - this.canvas.offsetLeft;\r\n        let y = e.pageY - this.canvas.offsetTop;\r\n        this.onMouseOver(e, x / this.zoom, y / this.zoom);\r\n    }\r\n\r\n    _onMouseOut(e){\r\n        e.preventDefault();\r\n        let to = $(e.toElement);\r\n        if(to.attr('handle') in this.elements){\r\n            return;\r\n        }\r\n        let x = e.pageX - this.canvas.offsetLeft;\r\n        let y = e.pageY - this.canvas.offsetTop;\r\n        this._MouseUp();\r\n        this.onMouseOut(e, x / this.zoom, y / this.zoom);\r\n    }\r\n\r\n    _onMouseWheel(e){\r\n        e.preventDefault();\r\n        this.zoom += -e.wheelDelta / 120 / 20;\r\n        if(this.zoom < 0.1){\r\n            this.zoom = 0.1;\r\n        } else if(this.zoom > 10){\r\n            this.zoom = 10;\r\n        }\r\n        this.render();\r\n    }\r\n\r\n    // Canvas Touch Events\r\n\r\n    _onTouchStart(e){\r\n        e.preventDefault();\r\n        if(e.touches.length === 2){\r\n            this.doubleTap = true;\r\n            this.tapDistance = this._calcDistance(\r\n                e.touches[0].pageX, e.touches[0].pageY,\r\n                e.touches[1].pageX, e.touches[1].pageY\r\n                );\r\n        }\r\n        let x = e.touches[0].pageX - this.canvas.offsetLeft;\r\n        let y = e.touches[0].pageY - this.canvas.offsetTop;\r\n        this._MouseDown(x, y);\r\n        let selected = this._onSelected(x, y);\r\n        if(selected != undefined){\r\n            selected.onTouchStart(e, x / this.zoom, y / this.zoom);\r\n        }\r\n        this.onTouchStart(e, x / this.zoom, y / this.zoom, selected);\r\n    }\r\n\r\n    _onTouchMove(e){\r\n        e.preventDefault();\r\n        if(e.touches.length === 2 && this.doubleTap){\r\n            let tapDistance = this._calcDistance(\r\n                e.touches[0].pageX, e.touches[0].pageY,\r\n                e.touches[1].pageX, e.touches[1].pageY\r\n                );\r\n            let diff = this.tapDistance - tapDistance;\r\n            this.zoom += -diff / this.canvas.width;\r\n            if(this.zoom < 0.1){\r\n                this.zoom = 0.1;\r\n            } else if(this.zoom > 10){\r\n                this.zoom = 10;\r\n            }\r\n            this.render();\r\n            this.tapDistance = tapDistance;\r\n        }\r\n        let x = e.touches[0].pageX - this.canvas.offsetLeft;\r\n        let y = e.touches[0].pageY - this.canvas.offsetTop;\r\n        this.onTouchMove(e, x / this.zoom, y / this.zoom);\r\n        let selected = this._onSelected(x, y);\r\n        if(selected != undefined){\r\n            if(this.selected == undefined || this.selected.handle != selected.handle){\r\n                this.selected = selected;\r\n                this.onTouch(e, x / this.zoom, y / this.zoom, selected);\r\n                selected.onTouchEnter(e, x / this.zoom, y / this.zoom);\r\n            }\r\n        } else {\r\n            if(this.selected != undefined){\r\n                let originalSelected = this.selected;\r\n                this.selected = selected;\r\n                this.onTouch(e, x / this.zoom, y / this.zoom, selected);\r\n                originalSelected.onTouchLeave(e, x / this.zoom, y / this.zoom);\r\n            }\r\n            if(this.infinity && this.mousedown && e.touches.length === 1){\r\n                this.offsetX += x - this.originX;\r\n                this.offsetY += y - this.originY;\r\n                this.originX = x;\r\n                this.originY = y;\r\n                this.render();\r\n            }\r\n        }\r\n    }\r\n\r\n    _onTouchEnd(e){\r\n        e.preventDefault();\r\n        if(e.touches.length !== 2){\r\n            this.doubleTap = false;\r\n            this.tapDistance = -1;\r\n        }\r\n        let x = e.changedTouches[0].pageX - this.canvas.offsetLeft;\r\n        let y = e.changedTouches[0].pageY - this.canvas.offsetTop;\r\n        this._MouseUp();\r\n        let selected = this._onSelected(x, y);\r\n        if(selected != undefined){\r\n            selected.onTouchEnd(e, x / this.zoom, y / this.zoom);\r\n        }\r\n        this.onTouchEnd(e, x / this.zoom, y / this.zoom, selected);\r\n    }\r\n\r\n    _onTouchCancel(e){\r\n        this._onTouchEnd(e);\r\n    }\r\n\r\n    // Elements Container Touch Events\r\n\r\n    _onContainerTouchStart(e){\r\n        e.preventDefault();\r\n        if(e.touches.length === 2){\r\n            this.doubleTap = true;\r\n            this.tapDistance = this._calcDistance(\r\n                e.touches[0].pageX, e.touches[0].pageY,\r\n                e.touches[1].pageX, e.touches[1].pageY\r\n                );\r\n        }\r\n        let element = $(e.target);\r\n        if(element.attr('handle') != undefined){\r\n            let box = this.elements[element.attr('handle')];\r\n            if(box != undefined){\r\n                let x = e.touches[0].pageX - this.canvas.offsetLeft;\r\n                let y = e.touches[0].pageY - this.canvas.offsetTop;\r\n                this.onTouchStart(e, x / this.zoom, y / this.zoom, box);\r\n                box.onTouchStart(e, x / this.zoom, y / this.zoom);\r\n            }\r\n        }\r\n    }\r\n\r\n    _onContainerTouchEnd(e){\r\n        e.preventDefault();\r\n        if(e.touches.length !== 2){\r\n            this.doubleTap = false;\r\n            this.tapDistance = -1;\r\n        }\r\n        let element = $(e.target);\r\n        if(element.attr('handle') != undefined){\r\n            let box = this.elements[element.attr('handle')];\r\n            if(box != undefined){\r\n                let x = e.changedTouches[0].pageX - this.canvas.offsetLeft;\r\n                let y = e.changedTouches[0].pageY - this.canvas.offsetTop;\r\n                this.onTouchEnd(e, x / this.zoom, y / this.zoom, box);\r\n                box.onTouchEnd(e, x / this.zoom, y / this.zoom);\r\n            }\r\n        }\r\n    }\r\n\r\n    _onContainerTouchCancel(e){\r\n        this._onContainerTouchEnd(e);\r\n    }\r\n\r\n    // Elements Container Events\r\n\r\n    _onContainerMouseUp(e){\r\n        // http://stackoverflow.com/questions/13236484/mouseup-not-working-after-mousemove-on-img\r\n        e.preventDefault();\r\n        let element = $(e.target);\r\n        if(element.attr('handle') != undefined){\r\n            let box = this.elements[element.attr('handle')];\r\n            if(box != undefined){\r\n                let x = e.pageX - this.canvas.offsetLeft;\r\n                let y = e.pageY - this.canvas.offsetTop;\r\n                this.onMouseUp(e, x / this.zoom, y / this.zoom, box);\r\n                box.onMouseUp(e, x / this.zoom, y / this.zoom);\r\n            }\r\n        }\r\n    }\r\n\r\n    _onContainerMouseDown(e){\r\n        e.preventDefault();\r\n        let element = $(e.target);\r\n        if(element.attr('handle') != undefined){\r\n            let box = this.elements[element.attr('handle')];\r\n            if(box != undefined){\r\n                let x = e.pageX - this.canvas.offsetLeft;\r\n                let y = e.pageY - this.canvas.offsetTop;\r\n                this.onMouseDown(e, x / this.zoom, y / this.zoom, box);\r\n                box.onMouseDown(e, x / this.zoom, y / this.zoom);\r\n            }\r\n        }\r\n    }\r\n\r\n    _onContainerMouseOver(e){\r\n        e.preventDefault();\r\n        let element = $(e.target);\r\n        if(element.attr('handle') != undefined){\r\n            let box = this.elements[element.attr('handle')];\r\n            if(box != undefined){\r\n                let x = e.pageX - this.canvas.offsetLeft;\r\n                let y = e.pageY - this.canvas.offsetTop;\r\n                this.onTouch(e, x / this.zoom, y / this.zoom, box);\r\n                box.onMouseOver(e, x / this.zoom, y / this.zoom);\r\n                if(x > 0 && x < this.canvas.width &&\r\n                    y > 0 && y < this.canvas.height){\r\n                        this.onMouseOver(e, x / this.zoom, y / this.zoom);\r\n                    }\r\n            }\r\n        }\r\n    }\r\n\r\n    _onContainerMouseOut(e){\r\n        e.preventDefault();\r\n        let element = $(e.target);\r\n        if(element.attr('handle') != undefined){\r\n            let box = this.elements[element.attr('handle')];\r\n            if(box != undefined){\r\n                let x = e.pageX - this.canvas.offsetLeft;\r\n                let y = e.pageY - this.canvas.offsetTop;\r\n                this.onTouch(e, x / this.zoom, y / this.zoom, null);\r\n                box.onMouseOut(e, x / this.zoom, y / this.zoom);\r\n                if(x < 0 || x > this.canvas.width ||\r\n                    y < 0 || y > this.canvas.height){\r\n                        this._MouseUp();\r\n                        this.onMouseOut(e, x / this.zoom, y / this.zoom);\r\n                    }\r\n            }\r\n        }\r\n    }\r\n\r\n    // Public Methods\r\n\r\n    addBox(box, x, y, z){\r\n        let handle = box.handle = uuid.v1();\r\n        this.boxs[handle] = box;\r\n        box.setPosition(x, y, z);\r\n        if(box.isElement){\r\n            this._addToDom(box);\r\n        } else {\r\n            this._addToLayer(box);\r\n            this.render();\r\n        }\r\n        box.scene = this;\r\n        box.mount = true;\r\n        return handle;\r\n    }\r\n\r\n    removeBox(handle){\r\n        let box = this.boxs[handle];\r\n        if(box != undefined){\r\n            if(box.isElement){\r\n                this._removeFromDom(box);\r\n            } else {\r\n                this._removeFromLayer(box);\r\n                this.render();\r\n            }\r\n            delete this.boxs[handle];\r\n            box._removePosition();\r\n            box.scene = null;\r\n            box.mount = false;\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    render(){\r\n        this.clear();\r\n        for(var i in this.layers){\r\n            let layer = this.layers[i];\r\n            _.forEach(layer, function(box, handle){\r\n                this._renderOne(box);\r\n            }.bind(this));\r\n        }\r\n        _.forEach(this.elements, function(element){\r\n            this._renderOne(element);\r\n        }.bind(this));\r\n    }\r\n\r\n    clear(){\r\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    }\r\n\r\n    close(){\r\n        _.forEach(this.boxs, function(box, handle){\r\n            this.removeBox(handle);\r\n        }.bind(this));\r\n        this.clear();\r\n    }\r\n\r\n    // events\r\n\r\n    onMouseUp(e, x, y, box){\r\n        // override it\r\n    }\r\n\r\n    onMouseDown(e, x, y, box){\r\n        // override it\r\n    }\r\n\r\n    onMouseMove(e, x, y){\r\n        // override it\r\n    }\r\n\r\n    onMouseOver(e, x, y){\r\n        // override it\r\n    }\r\n\r\n    onMouseOut(e, x, y){\r\n        // override it\r\n    }\r\n\r\n    onTouch(e, x, y, box){\r\n        // override it\r\n    }\r\n\r\n    // touch events\r\n\r\n    onTouchStart(e, x, y, box){\r\n        // override it\r\n    }\r\n\r\n    onTouchMove(e, x, y){\r\n        // override it\r\n    }\r\n\r\n    onTouchEnd(e, x, y, box){\r\n        // override it\r\n    }\r\n\r\n}"]}