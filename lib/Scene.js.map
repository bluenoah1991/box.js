{"version":3,"sources":["../src/Scene.js"],"names":["Scene","id","canvas","document","getElementById","ctx","getContext","layers","reverseLayers","onmouseup","_onMouseUp","bind","onmousedown","_onMouseDown","onmousemove","_onMouseMove","onmouseover","_onMouseOver","onmouseout","_onMouseOut","box","layer","z","undefined","handle","i","unshift","x","y","render","e","pageX","offsetLeft","pageY","offsetTop","selected","isPointInPath","path","_onSelected","onMouseUp","onMouseDown","onMouseMove","onMouseOver","onMouseOut","v1","setPosition","mount","_addToLayer","clear","forEach","_renderOne","clearRect","width","height"],"mappings":"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","file":"Scene.js","sourcesContent":["import _ from 'lodash';\r\nimport uuid from 'node-uuid';\r\n\r\nimport Context from './Context';\r\n\r\nexport default class Scene{\r\n    constructor(id){\r\n        this.canvas = document.getElementById(id);\r\n        this.ctx = this.canvas.getContext('2d');\r\n        this.layers = [];\r\n        this.reverseLayers = [];\r\n\r\n        this.canvas.onmouseup = this._onMouseUp.bind(this);\r\n        this.canvas.onmousedown = this._onMouseDown.bind(this);\r\n        this.canvas.onmousemove = this._onMouseMove.bind(this);\r\n\r\n        this.canvas.onmouseover = this._onMouseOver.bind(this);\r\n        this.canvas.onmouseout = this._onMouseOut.bind(this);\r\n    }\r\n\r\n    _addToLayer(box){\r\n        let layer = this.layers[box.z];\r\n        if(layer == undefined){\r\n            layer = {};\r\n            this.layers[box.z] = layer;\r\n        }\r\n        layer[box.handle] = box;\r\n        this.reverseLayers = [];\r\n        for(var i in this.layers){\r\n            this.reverseLayers.unshift(this.layers[i]);\r\n        }\r\n    }\r\n\r\n    _renderOne(box){\r\n        let ctx = new Context(this.ctx, box.x, box.y);\r\n        box.render(ctx);\r\n    }\r\n\r\n    _onSelected(e){\r\n        let x = e.pageX - this.canvas.offsetLeft;\r\n        let y = e.pageY - this.canvas.offsetTop;\r\n        let selected = null;\r\n        for(var i in this.reverseLayers){\r\n            let layer = this.reverseLayers[i];\r\n            for(var handle in layer){\r\n                let box = layer[handle];\r\n                if(this.ctx.isPointInPath(box.path, x, y)){\r\n                    selected = box;\r\n                    break;\r\n                }\r\n            }\r\n            if(selected != undefined){\r\n                break;\r\n            }\r\n        }\r\n        return selected;\r\n    }\r\n\r\n    _onMouseUp(e){\r\n        let selected = this._onSelected(e);\r\n        this.onMouseUp(e, selected);\r\n    }\r\n\r\n    _onMouseDown(e){\r\n        let selected = this._onSelected(e);\r\n        this.onMouseDown(e, selected);\r\n    }\r\n\r\n    _onMouseMove(e){\r\n        let x = e.pageX - this.canvas.offsetLeft;\r\n        let y = e.pageY - this.canvas.offsetTop;\r\n        this.onMouseMove(e, x, y);\r\n    }\r\n\r\n    _onMouseOver(e){\r\n        let x = e.pageX - this.canvas.offsetLeft;\r\n        let y = e.pageY - this.canvas.offsetTop;\r\n        this.onMouseOver(e, x, y);\r\n    }\r\n\r\n    _onMouseOut(e){\r\n        let x = e.pageX - this.canvas.offsetLeft;\r\n        let y = e.pageY - this.canvas.offsetTop;\r\n        this.onMouseOut(e, x, y);\r\n    }\r\n\r\n    addBox(box, x, y, z){\r\n        let handle = box.handle = uuid.v1();\r\n        box.setPosition(x, y);\r\n        box.z = z || 0;\r\n        box.mount = true;\r\n        this._addToLayer(box);\r\n        this.render();\r\n        return handle;\r\n    }\r\n\r\n    render(){\r\n        this.clear();\r\n        for(var i in this.layers){\r\n            let layer = this.layers[i];\r\n            _.forEach(layer, function(box, handle){\r\n                this._renderOne(box);\r\n            }.bind(this));\r\n        }\r\n    }\r\n\r\n    clear(){\r\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    }\r\n\r\n    // events\r\n\r\n    onMouseUp(e, box){\r\n        // override it\r\n    }\r\n\r\n    onMouseDown(e, box){\r\n        // override it\r\n    }\r\n\r\n    onMouseMove(e, x, y){\r\n        // override it\r\n    }\r\n\r\n    onMouseOver(e, x, y){\r\n        // override it\r\n    }\r\n\r\n    onMouseOut(e, x, y){\r\n        // override it\r\n    }\r\n\r\n}"]}