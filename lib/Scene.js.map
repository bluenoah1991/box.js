{"version":3,"sources":["../src/Scene.js"],"names":["Scene","id","opts","canvas","document","getElementById","ctx","getContext","layers","reverseLayers","selected","elementContainer","_initElementContainer","elements","infinity","offsetX","offsetY","mousedown","originX","originY","onmouseup","_onMouseUp","bind","onmousedown","_onMouseDown","onmousemove","_onMouseMove","onmouseover","_onMouseOver","onmouseout","_onMouseOut","on","_onContainerMouseUp","_onContainerMouseDown","_onContainerMouseOver","_onContainerMouseOut","$","border_top_width","parseInt","css","border_right_width","border_bottom_width","border_left_width","container","display","overflow","width","height","position","left","offsetLeft","top","offsetTop","pointerEvents","append","box","layer","z","undefined","handle","i","unshift","element","attr","x","y","isElement","render","paths","_getPaths","_include","e","preventDefault","pageX","pageY","_MouseUp","_onSelected","onMouseUp","_MouseDown","onMouseDown","onMouseMove","onTouch","onMouseOver","originalSelected","onMouseOut","from","fromElement","to","toElement","target","v1","setPosition","_addToDom","_addToLayer","scene","mount","clear","forEach","_renderOne","clearRect"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AAEA;;;;;;;;IAEqBA,K;AACjB,mBAAYC,EAAZ,EAAgBC,IAAhB,EAAqB;AAAA;;AACjB,aAAKC,MAAL,GAAcC,SAASC,cAAT,CAAwBJ,EAAxB,CAAd;AACA,aAAKK,GAAL,GAAW,KAAKH,MAAL,CAAYI,UAAZ,CAAuB,IAAvB,CAAX;AACA,aAAKC,MAAL,GAAc,EAAd;AACA,aAAKC,aAAL,GAAqB,EAArB;AACA,aAAKC,QAAL,GAAgB,IAAhB;AACA,aAAKC,gBAAL,GAAwB,KAAKC,qBAAL,EAAxB;AACA,aAAKC,QAAL,GAAgB,EAAhB;;AAEA;AACA,aAAKX,IAAL,GAAYA,QAAQ,EAApB;AACA,aAAKY,QAAL,GAAgB,KAAKZ,IAAL,CAAUY,QAAV,IAAsB,KAAtC;;AAGA;AACA,aAAKC,OAAL,GAAe,CAAf;AACA,aAAKC,OAAL,GAAe,CAAf;;AAEA;AACA,aAAKC,SAAL,GAAiB,KAAjB;AACA,aAAKC,OAAL,GAAe,CAAC,CAAhB;AACA,aAAKC,OAAL,GAAe,CAAC,CAAhB;;AAEA;AACA,aAAKhB,MAAL,CAAYiB,SAAZ,GAAwB,KAAKC,UAAL,CAAgBC,IAAhB,CAAqB,IAArB,CAAxB;AACA,aAAKnB,MAAL,CAAYoB,WAAZ,GAA0B,KAAKC,YAAL,CAAkBF,IAAlB,CAAuB,IAAvB,CAA1B;AACA,aAAKnB,MAAL,CAAYsB,WAAZ,GAA0B,KAAKC,YAAL,CAAkBJ,IAAlB,CAAuB,IAAvB,CAA1B;AACA,aAAKnB,MAAL,CAAYwB,WAAZ,GAA0B,KAAKC,YAAL,CAAkBN,IAAlB,CAAuB,IAAvB,CAA1B;AACA,aAAKnB,MAAL,CAAY0B,UAAZ,GAAyB,KAAKC,WAAL,CAAiBR,IAAjB,CAAsB,IAAtB,CAAzB;;AAEA,aAAKX,gBAAL,CAAsBoB,EAAtB,CAAyB,SAAzB,EAAoC,GAApC,EAAyC,KAAKC,mBAAL,CAAyBV,IAAzB,CAA8B,IAA9B,CAAzC;AACA,aAAKX,gBAAL,CAAsBoB,EAAtB,CAAyB,WAAzB,EAAsC,GAAtC,EAA2C,KAAKE,qBAAL,CAA2BX,IAA3B,CAAgC,IAAhC,CAA3C;AACA,aAAKX,gBAAL,CAAsBoB,EAAtB,CAAyB,WAAzB,EAAsC,GAAtC,EAA2C,KAAKL,YAAL,CAAkBJ,IAAlB,CAAuB,IAAvB,CAA3C;AACA,aAAKX,gBAAL,CAAsBoB,EAAtB,CAAyB,WAAzB,EAAsC,GAAtC,EAA2C,KAAKG,qBAAL,CAA2BZ,IAA3B,CAAgC,IAAhC,CAA3C;AACA,aAAKX,gBAAL,CAAsBoB,EAAtB,CAAyB,UAAzB,EAAqC,GAArC,EAA0C,KAAKI,oBAAL,CAA0Bb,IAA1B,CAA+B,IAA/B,CAA1C;AACH;;;;gDAEsB;AACnB,gBAAInB,SAASiC,EAAE,KAAKjC,MAAP,CAAb;AACA,gBAAIkC,mBAAmBC,SAASnC,OAAOoC,GAAP,CAAW,kBAAX,CAAT,CAAvB;AACA,gBAAIC,qBAAqBF,SAASnC,OAAOoC,GAAP,CAAW,oBAAX,CAAT,CAAzB;AACA,gBAAIE,sBAAsBH,SAASnC,OAAOoC,GAAP,CAAW,qBAAX,CAAT,CAA1B;AACA,gBAAIG,oBAAoBJ,SAASnC,OAAOoC,GAAP,CAAW,mBAAX,CAAT,CAAxB;AACA,gBAAII,YAAYP,EAAE,SAAF,CAAhB;AACAO,sBAAUJ,GAAV,CAAc;AACVK,yBAAS,cADC;AAEVC,0BAAU,QAFA;AAGVC,uBAAO3C,OAAO2C,KAAP,KAAiBJ,iBAAjB,GAAqCF,kBAHlC;AAIVO,wBAAQ5C,OAAO4C,MAAP,KAAkBV,gBAAlB,GAAqCI,mBAJnC;AAKVO,0BAAU,UALA;AAMVC,sBAAM,KAAK9C,MAAL,CAAY+C,UAAZ,GAAyBR,iBANrB;AAOVS,qBAAK,KAAKhD,MAAL,CAAYiD,SAAZ,GAAwBf,gBAPnB;AAQVgB,+BAAe;AARL,aAAd;AAUAjB,cAAE,MAAF,EAAUkB,MAAV,CAAiBX,SAAjB;AACA,mBAAOA,SAAP;AACH;;;oCAEWY,G,EAAI;AACZ,gBAAIC,QAAQ,KAAKhD,MAAL,CAAY+C,IAAIE,CAAhB,CAAZ;AACA,gBAAGD,SAASE,SAAZ,EAAsB;AAClBF,wBAAQ,EAAR;AACA,qBAAKhD,MAAL,CAAY+C,IAAIE,CAAhB,IAAqBD,KAArB;AACH;AACDA,kBAAMD,IAAII,MAAV,IAAoBJ,GAApB;AACA,iBAAK9C,aAAL,GAAqB,EAArB;AACA,iBAAI,IAAImD,CAAR,IAAa,KAAKpD,MAAlB,EAAyB;AACrB,qBAAKC,aAAL,CAAmBoD,OAAnB,CAA2B,KAAKrD,MAAL,CAAYoD,CAAZ,CAA3B;AACH;AACJ;;;kCAESL,G,EAAI;AACV,iBAAK1C,QAAL,CAAc0C,IAAII,MAAlB,IAA4BJ,GAA5B;AACAA,gBAAIO,OAAJ,CAAYC,IAAZ,CAAiB,QAAjB,EAA2BR,IAAII,MAA/B;AACAJ,gBAAIO,OAAJ,CAAYvB,GAAZ,CAAgB,gBAAhB,EAAkC,MAAlC;AACAgB,gBAAIO,OAAJ,CAAYvB,GAAZ,CAAgB,UAAhB,EAA4B,UAA5B;AACAgB,gBAAIO,OAAJ,CAAYvB,GAAZ,CAAgB,MAAhB,EAAwBgB,IAAIS,CAA5B;AACAT,gBAAIO,OAAJ,CAAYvB,GAAZ,CAAgB,KAAhB,EAAuBgB,IAAIU,CAA3B;AACA,iBAAKtD,gBAAL,CAAsB2C,MAAtB,CAA6BC,IAAIO,OAAjC;AACH;;;mCAEUP,G,EAAI;AACX,gBAAGA,IAAIW,SAAP,EAAiB;AACbX,oBAAIO,OAAJ,CAAYvB,GAAZ,CAAgB,MAAhB,EAAwBgB,IAAIS,CAAJ,GAAQ,KAAKjD,OAArC;AACAwC,oBAAIO,OAAJ,CAAYvB,GAAZ,CAAgB,KAAhB,EAAuBgB,IAAIU,CAAJ,GAAQ,KAAKjD,OAApC;AACH,aAHD,MAGO;AACH,oBAAIV,MAAM,sBAAY,KAAKA,GAAjB,EAAsBiD,IAAIS,CAAJ,GAAQ,KAAKjD,OAAnC,EAA4CwC,IAAIU,CAAJ,GAAQ,KAAKjD,OAAzD,CAAV;AACAuC,oBAAIY,MAAJ,CAAW7D,GAAX;AACAiD,oBAAIa,KAAJ,GAAY9D,IAAI+D,SAAJ,EAAZ;AACH;AACJ;;;oCAEWL,C,EAAGC,C,EAAE;AACb,gBAAIvD,WAAW,IAAf;AACA,iBAAI,IAAIkD,CAAR,IAAa,KAAKnD,aAAlB,EAAgC;AAC5B,oBAAI+C,QAAQ,KAAK/C,aAAL,CAAmBmD,CAAnB,CAAZ;AACA,qBAAI,IAAID,MAAR,IAAkBH,KAAlB,EAAwB;AACpB,wBAAID,MAAMC,MAAMG,MAAN,CAAV;AACA,wBAAGJ,IAAIe,QAAJ,CAAaN,CAAb,EAAgBC,CAAhB,CAAH,EAAsB;AAClBvD,mCAAW6C,GAAX;AACA;AACH;AACJ;AACD,oBAAG7C,YAAYgD,SAAf,EAAyB;AACrB;AACH;AACJ;AACD,mBAAOhD,QAAP;AACH;;AAED;;;;mCAEWsD,C,EAAGC,C,EAAE;AACZ,iBAAKhD,SAAL,GAAiB,IAAjB;AACA,iBAAKC,OAAL,GAAe8C,CAAf;AACA,iBAAK7C,OAAL,GAAe8C,CAAf;AACH;;;mCAES;AACN,iBAAKhD,SAAL,GAAiB,KAAjB;AACA,iBAAKC,OAAL,GAAe,CAAC,CAAhB;AACA,iBAAKC,OAAL,GAAe,CAAC,CAAhB;AACH;;AAED;;;;mCAEWoD,C,EAAE;AACTA,cAAEC,cAAF;AACA,gBAAIR,IAAIO,EAAEE,KAAF,GAAU,KAAKtE,MAAL,CAAY+C,UAA9B;AACA,gBAAIe,IAAIM,EAAEG,KAAF,GAAU,KAAKvE,MAAL,CAAYiD,SAA9B;AACA,iBAAKuB,QAAL;AACA,gBAAIjE,WAAW,KAAKkE,WAAL,CAAiBZ,CAAjB,EAAoBC,CAApB,CAAf;AACA,gBAAGvD,YAAYgD,SAAf,EAAyB;AACrBhD,yBAASmE,SAAT,CAAmBN,CAAnB,EAAsBP,CAAtB,EAAyBC,CAAzB;AACH;AACD,iBAAKY,SAAL,CAAeN,CAAf,EAAkBP,CAAlB,EAAqBC,CAArB,EAAwBvD,QAAxB;AACH;;;qCAEY6D,C,EAAE;AACXA,cAAEC,cAAF;AACA,gBAAIR,IAAIO,EAAEE,KAAF,GAAU,KAAKtE,MAAL,CAAY+C,UAA9B;AACA,gBAAIe,IAAIM,EAAEG,KAAF,GAAU,KAAKvE,MAAL,CAAYiD,SAA9B;AACA,iBAAK0B,UAAL,CAAgBd,CAAhB,EAAmBC,CAAnB;AACA,gBAAIvD,WAAW,KAAKkE,WAAL,CAAiBZ,CAAjB,EAAoBC,CAApB,CAAf;AACA,gBAAGvD,YAAYgD,SAAf,EAAyB;AACrBhD,yBAASqE,WAAT,CAAqBR,CAArB,EAAwBP,CAAxB,EAA2BC,CAA3B;AACH;AACD,iBAAKc,WAAL,CAAiBR,CAAjB,EAAoBP,CAApB,EAAuBC,CAAvB,EAA0BvD,QAA1B;AACH;;;qCAEY6D,C,EAAE;AACXA,cAAEC,cAAF;AACA,gBAAIR,IAAIO,EAAEE,KAAF,GAAU,KAAKtE,MAAL,CAAY+C,UAA9B;AACA,gBAAIe,IAAIM,EAAEG,KAAF,GAAU,KAAKvE,MAAL,CAAYiD,SAA9B;AACA,iBAAK4B,WAAL,CAAiBT,CAAjB,EAAoBP,CAApB,EAAuBC,CAAvB;AACA,gBAAIvD,WAAW,KAAKkE,WAAL,CAAiBZ,CAAjB,EAAoBC,CAApB,CAAf;AACA,gBAAGvD,YAAYgD,SAAf,EAAyB;AACrB,oBAAG,KAAKhD,QAAL,IAAiBgD,SAAjB,IAA8B,KAAKhD,QAAL,CAAciD,MAAd,IAAwBjD,SAASiD,MAAlE,EAAyE;AACrE,yBAAKjD,QAAL,GAAgBA,QAAhB;AACA,yBAAKuE,OAAL,CAAaV,CAAb,EAAgBP,CAAhB,EAAmBC,CAAnB,EAAsBvD,QAAtB;AACAA,6BAASwE,WAAT,CAAqBX,CAArB,EAAwBP,CAAxB,EAA2BC,CAA3B;AACH;AACJ,aAND,MAMO;AACH,oBAAG,KAAKvD,QAAL,IAAiBgD,SAApB,EAA8B;AAC1B,wBAAIyB,mBAAmB,KAAKzE,QAA5B;AACA,yBAAKA,QAAL,GAAgBA,QAAhB;AACA,yBAAKuE,OAAL,CAAaV,CAAb,EAAgBP,CAAhB,EAAmBC,CAAnB,EAAsBvD,QAAtB;AACAyE,qCAAiBC,UAAjB,CAA4Bb,CAA5B,EAA+BP,CAA/B,EAAkCC,CAAlC;AACH;AACD,oBAAG,KAAKnD,QAAL,IAAiB,KAAKG,SAAzB,EAAmC;AAC/B,yBAAKF,OAAL,IAAgBiD,IAAI,KAAK9C,OAAzB;AACA,yBAAKF,OAAL,IAAgBiD,IAAI,KAAK9C,OAAzB;AACA,yBAAKD,OAAL,GAAe8C,CAAf;AACA,yBAAK7C,OAAL,GAAe8C,CAAf;AACA,yBAAKE,MAAL;AACH;AACJ;AACJ;;;qCAEYI,C,EAAE;AACXA,cAAEC,cAAF;AACA,gBAAIa,OAAOjD,EAAEmC,EAAEe,WAAJ,CAAX;AACA,gBAAGD,KAAKtB,IAAL,CAAU,QAAV,KAAuB,KAAKlD,QAA/B,EAAwC;AACpC;AACH;AACD,gBAAImD,IAAIO,EAAEE,KAAF,GAAU,KAAKtE,MAAL,CAAY+C,UAA9B;AACA,gBAAIe,IAAIM,EAAEG,KAAF,GAAU,KAAKvE,MAAL,CAAYiD,SAA9B;AACA,iBAAK8B,WAAL,CAAiBX,CAAjB,EAAoBP,CAApB,EAAuBC,CAAvB;AACH;;;oCAEWM,C,EAAE;AACVA,cAAEC,cAAF;AACA,gBAAIe,KAAKnD,EAAEmC,EAAEiB,SAAJ,CAAT;AACA,gBAAGD,GAAGxB,IAAH,CAAQ,QAAR,KAAqB,KAAKlD,QAA7B,EAAsC;AAClC;AACH;AACD,gBAAImD,IAAIO,EAAEE,KAAF,GAAU,KAAKtE,MAAL,CAAY+C,UAA9B;AACA,gBAAIe,IAAIM,EAAEG,KAAF,GAAU,KAAKvE,MAAL,CAAYiD,SAA9B;AACA,iBAAKuB,QAAL;AACA,iBAAKS,UAAL,CAAgBb,CAAhB,EAAmBP,CAAnB,EAAsBC,CAAtB;AACH;;AAED;;;;4CAEoBM,C,EAAE;AAClB;AACAA,cAAEC,cAAF;AACA,gBAAIV,UAAU1B,EAAEmC,EAAEkB,MAAJ,CAAd;AACA,gBAAG3B,QAAQC,IAAR,CAAa,QAAb,KAA0BL,SAA7B,EAAuC;AACnC,oBAAIH,MAAM,KAAK1C,QAAL,CAAciD,QAAQC,IAAR,CAAa,QAAb,CAAd,CAAV;AACA,oBAAGR,OAAOG,SAAV,EAAoB;AAChB,wBAAIM,IAAIO,EAAEE,KAAF,GAAU,KAAKtE,MAAL,CAAY+C,UAA9B;AACA,wBAAIe,IAAIM,EAAEG,KAAF,GAAU,KAAKvE,MAAL,CAAYiD,SAA9B;AACA,yBAAKyB,SAAL,CAAeN,CAAf,EAAkBP,CAAlB,EAAqBC,CAArB,EAAwBV,GAAxB;AACAA,wBAAIsB,SAAJ,CAAcN,CAAd,EAAiBP,CAAjB,EAAoBC,CAApB;AACH;AACJ;AACJ;;;8CAEqBM,C,EAAE;AACpBA,cAAEC,cAAF;AACA,gBAAIV,UAAU1B,EAAEmC,EAAEkB,MAAJ,CAAd;AACA,gBAAG3B,QAAQC,IAAR,CAAa,QAAb,KAA0BL,SAA7B,EAAuC;AACnC,oBAAIH,MAAM,KAAK1C,QAAL,CAAciD,QAAQC,IAAR,CAAa,QAAb,CAAd,CAAV;AACA,oBAAGR,OAAOG,SAAV,EAAoB;AAChB,wBAAIM,IAAIO,EAAEE,KAAF,GAAU,KAAKtE,MAAL,CAAY+C,UAA9B;AACA,wBAAIe,IAAIM,EAAEG,KAAF,GAAU,KAAKvE,MAAL,CAAYiD,SAA9B;AACA,yBAAK2B,WAAL,CAAiBR,CAAjB,EAAoBP,CAApB,EAAuBC,CAAvB,EAA0BV,GAA1B;AACAA,wBAAIwB,WAAJ,CAAgBR,CAAhB,EAAmBP,CAAnB,EAAsBC,CAAtB;AACH;AACJ;AACJ;;;8CAEqBM,C,EAAE;AACpBA,cAAEC,cAAF;AACA,gBAAIV,UAAU1B,EAAEmC,EAAEkB,MAAJ,CAAd;AACA,gBAAG3B,QAAQC,IAAR,CAAa,QAAb,KAA0BL,SAA7B,EAAuC;AACnC,oBAAIH,MAAM,KAAK1C,QAAL,CAAciD,QAAQC,IAAR,CAAa,QAAb,CAAd,CAAV;AACA,oBAAGR,OAAOG,SAAV,EAAoB;AAChB,wBAAIM,IAAIO,EAAEE,KAAF,GAAU,KAAKtE,MAAL,CAAY+C,UAA9B;AACA,wBAAIe,IAAIM,EAAEG,KAAF,GAAU,KAAKvE,MAAL,CAAYiD,SAA9B;AACA,yBAAK6B,OAAL,CAAaV,CAAb,EAAgBP,CAAhB,EAAmBC,CAAnB,EAAsBV,GAAtB;AACAA,wBAAI2B,WAAJ,CAAgBX,CAAhB,EAAmBP,CAAnB,EAAsBC,CAAtB;AACA,wBAAGD,IAAI,CAAJ,IAASA,IAAI,KAAK7D,MAAL,CAAY2C,KAAzB,IACCmB,IAAI,CADL,IACUA,IAAI,KAAK9D,MAAL,CAAY4C,MAD7B,EACoC;AAC5B,6BAAKmC,WAAL,CAAiBX,CAAjB,EAAoBP,CAApB,EAAuBC,CAAvB;AACH;AACR;AACJ;AACJ;;;6CAEoBM,C,EAAE;AACnBA,cAAEC,cAAF;AACA,gBAAIV,UAAU1B,EAAEmC,EAAEkB,MAAJ,CAAd;AACA,gBAAG3B,QAAQC,IAAR,CAAa,QAAb,KAA0BL,SAA7B,EAAuC;AACnC,oBAAIH,MAAM,KAAK1C,QAAL,CAAciD,QAAQC,IAAR,CAAa,QAAb,CAAd,CAAV;AACA,oBAAGR,OAAOG,SAAV,EAAoB;AAChB,wBAAIM,IAAIO,EAAEE,KAAF,GAAU,KAAKtE,MAAL,CAAY+C,UAA9B;AACA,wBAAIe,IAAIM,EAAEG,KAAF,GAAU,KAAKvE,MAAL,CAAYiD,SAA9B;AACA,yBAAK6B,OAAL,CAAaV,CAAb,EAAgBP,CAAhB,EAAmBC,CAAnB,EAAsB,IAAtB;AACAV,wBAAI6B,UAAJ,CAAeb,CAAf,EAAkBP,CAAlB,EAAqBC,CAArB;AACA,wBAAGD,IAAI,CAAJ,IAASA,IAAI,KAAK7D,MAAL,CAAY2C,KAAzB,IACCmB,IAAI,CADL,IACUA,IAAI,KAAK9D,MAAL,CAAY4C,MAD7B,EACoC;AAC5B,6BAAK4B,QAAL;AACA,6BAAKS,UAAL,CAAgBb,CAAhB,EAAmBP,CAAnB,EAAsBC,CAAtB;AACH;AACR;AACJ;AACJ;;AAED;;;;+BAEOV,G,EAAKS,C,EAAGC,C,EAAGR,C,EAAE;AAChB,gBAAIE,SAASJ,IAAII,MAAJ,GAAa,mBAAK+B,EAAL,EAA1B;AACAnC,gBAAIoC,WAAJ,CAAgB3B,CAAhB,EAAmBC,CAAnB;AACAV,gBAAIE,CAAJ,GAAQA,KAAK,CAAb;AACA,gBAAGF,IAAIW,SAAP,EAAiB;AACb,qBAAK0B,SAAL,CAAerC,GAAf;AACH,aAFD,MAEO;AACH,qBAAKsC,WAAL,CAAiBtC,GAAjB;AACA,qBAAKY,MAAL;AACH;AACDZ,gBAAIuC,KAAJ,GAAY,IAAZ;AACAvC,gBAAIwC,KAAJ,GAAY,IAAZ;AACA,mBAAOpC,MAAP;AACH;;;iCAEO;AACJ,iBAAKqC,KAAL;AACA,iBAAI,IAAIpC,CAAR,IAAa,KAAKpD,MAAlB,EAAyB;AACrB,oBAAIgD,QAAQ,KAAKhD,MAAL,CAAYoD,CAAZ,CAAZ;AACA,iCAAEqC,OAAF,CAAUzC,KAAV,EAAiB,UAASD,GAAT,EAAcI,MAAd,EAAqB;AAClC,yBAAKuC,UAAL,CAAgB3C,GAAhB;AACH,iBAFgB,CAEfjC,IAFe,CAEV,IAFU,CAAjB;AAGH;AACD,6BAAE2E,OAAF,CAAU,KAAKpF,QAAf,EAAyB,UAASiD,OAAT,EAAiB;AACtC,qBAAKoC,UAAL,CAAgBpC,OAAhB;AACH,aAFwB,CAEvBxC,IAFuB,CAElB,IAFkB,CAAzB;AAGH;;;gCAEM;AACH,iBAAKhB,GAAL,CAAS6F,SAAT,CAAmB,CAAnB,EAAsB,CAAtB,EAAyB,KAAKhG,MAAL,CAAY2C,KAArC,EAA4C,KAAK3C,MAAL,CAAY4C,MAAxD;AACH;;AAED;;;;kCAEUwB,C,EAAGP,C,EAAGC,C,EAAGV,G,EAAI;AACnB;AACH;;;oCAEWgB,C,EAAGP,C,EAAGC,C,EAAGV,G,EAAI;AACrB;AACH;;;oCAEWgB,C,EAAGP,C,EAAGC,C,EAAE;AAChB;AACH;;;oCAEWM,C,EAAGP,C,EAAGC,C,EAAE;AAChB;AACH;;;mCAEUM,C,EAAGP,C,EAAGC,C,EAAE;AACf;AACH;;;gCAEOM,C,EAAGP,C,EAAGC,C,EAAGV,G,EAAI;AACjB;AACH;;;;;;kBAzUgBvD,K","file":"Scene.js","sourcesContent":["import _ from 'lodash';\r\nimport uuid from 'node-uuid';\r\n\r\nimport Context from './Context';\r\n\r\nexport default class Scene{\r\n    constructor(id, opts){\r\n        this.canvas = document.getElementById(id);\r\n        this.ctx = this.canvas.getContext('2d');\r\n        this.layers = [];\r\n        this.reverseLayers = [];\r\n        this.selected = null;\r\n        this.elementContainer = this._initElementContainer();\r\n        this.elements = {};\r\n\r\n        // Options\r\n        this.opts = opts || {};\r\n        this.infinity = this.opts.infinity || false;\r\n\r\n\r\n        // Parameters associated with Infinite Canvas\r\n        this.offsetX = 0;\r\n        this.offsetY = 0;\r\n\r\n        // Parameters associated with Mousedown\r\n        this.mousedown = false;\r\n        this.originX = -1;\r\n        this.originY = -1;\r\n\r\n        // Register Event\r\n        this.canvas.onmouseup = this._onMouseUp.bind(this);\r\n        this.canvas.onmousedown = this._onMouseDown.bind(this);\r\n        this.canvas.onmousemove = this._onMouseMove.bind(this);\r\n        this.canvas.onmouseover = this._onMouseOver.bind(this);\r\n        this.canvas.onmouseout = this._onMouseOut.bind(this);\r\n\r\n        this.elementContainer.on('mouseup', '*', this._onContainerMouseUp.bind(this));\r\n        this.elementContainer.on('mousedown', '*', this._onContainerMouseDown.bind(this));\r\n        this.elementContainer.on('mousemove', '*', this._onMouseMove.bind(this));\r\n        this.elementContainer.on('mouseover', '*', this._onContainerMouseOver.bind(this));\r\n        this.elementContainer.on('mouseout', '*', this._onContainerMouseOut.bind(this));\r\n    }\r\n\r\n    _initElementContainer(){\r\n        let canvas = $(this.canvas);\r\n        let border_top_width = parseInt(canvas.css('border-top-width'));\r\n        let border_right_width = parseInt(canvas.css('border-right-width'));\r\n        let border_bottom_width = parseInt(canvas.css('border-bottom-width'));\r\n        let border_left_width = parseInt(canvas.css('border-left-width'));\r\n        let container = $('<div />');\r\n        container.css({\r\n            display: 'inline-block',\r\n            overflow: 'hidden',\r\n            width: canvas.width() - border_left_width - border_right_width,\r\n            height: canvas.height() - border_top_width - border_bottom_width,\r\n            position: 'absolute',\r\n            left: this.canvas.offsetLeft + border_left_width,\r\n            top: this.canvas.offsetTop + border_top_width,\r\n            pointerEvents: 'none'\r\n        });\r\n        $('body').append(container);\r\n        return container;\r\n    }\r\n\r\n    _addToLayer(box){\r\n        let layer = this.layers[box.z];\r\n        if(layer == undefined){\r\n            layer = {};\r\n            this.layers[box.z] = layer;\r\n        }\r\n        layer[box.handle] = box;\r\n        this.reverseLayers = [];\r\n        for(var i in this.layers){\r\n            this.reverseLayers.unshift(this.layers[i]);\r\n        }\r\n    }\r\n\r\n    _addToDom(box){\r\n        this.elements[box.handle] = box;\r\n        box.element.attr('handle', box.handle);\r\n        box.element.css('pointer-events', 'auto');\r\n        box.element.css('position', 'relative');\r\n        box.element.css('left', box.x);\r\n        box.element.css('top', box.y);\r\n        this.elementContainer.append(box.element);\r\n    }\r\n\r\n    _renderOne(box){\r\n        if(box.isElement){\r\n            box.element.css('left', box.x + this.offsetX);\r\n            box.element.css('top', box.y + this.offsetY);\r\n        } else {\r\n            let ctx = new Context(this.ctx, box.x + this.offsetX, box.y + this.offsetY);\r\n            box.render(ctx);\r\n            box.paths = ctx._getPaths();\r\n        }\r\n    }\r\n\r\n    _onSelected(x, y){\r\n        let selected = null;\r\n        for(var i in this.reverseLayers){\r\n            let layer = this.reverseLayers[i];\r\n            for(var handle in layer){\r\n                let box = layer[handle];\r\n                if(box._include(x, y)){\r\n                    selected = box;\r\n                    break;\r\n                }\r\n            }\r\n            if(selected != undefined){\r\n                break;\r\n            }\r\n        }\r\n        return selected;\r\n    }\r\n\r\n    // Methods associated with Mousedown\r\n\r\n    _MouseDown(x, y){\r\n        this.mousedown = true;\r\n        this.originX = x;\r\n        this.originY = y;\r\n    }\r\n\r\n    _MouseUp(){\r\n        this.mousedown = false;\r\n        this.originX = -1;\r\n        this.originY = -1;\r\n    }\r\n\r\n    // Canvas Events\r\n\r\n    _onMouseUp(e){\r\n        e.preventDefault();\r\n        let x = e.pageX - this.canvas.offsetLeft;\r\n        let y = e.pageY - this.canvas.offsetTop;\r\n        this._MouseUp();\r\n        let selected = this._onSelected(x, y);\r\n        if(selected != undefined){\r\n            selected.onMouseUp(e, x, y);\r\n        }\r\n        this.onMouseUp(e, x, y, selected);\r\n    }\r\n\r\n    _onMouseDown(e){\r\n        e.preventDefault();\r\n        let x = e.pageX - this.canvas.offsetLeft;\r\n        let y = e.pageY - this.canvas.offsetTop;\r\n        this._MouseDown(x, y);\r\n        let selected = this._onSelected(x, y);\r\n        if(selected != undefined){\r\n            selected.onMouseDown(e, x, y);\r\n        }\r\n        this.onMouseDown(e, x, y, selected);\r\n    }\r\n\r\n    _onMouseMove(e){\r\n        e.preventDefault();\r\n        let x = e.pageX - this.canvas.offsetLeft;\r\n        let y = e.pageY - this.canvas.offsetTop;\r\n        this.onMouseMove(e, x, y);\r\n        let selected = this._onSelected(x, y);\r\n        if(selected != undefined){\r\n            if(this.selected == undefined || this.selected.handle != selected.handle){\r\n                this.selected = selected;\r\n                this.onTouch(e, x, y, selected);\r\n                selected.onMouseOver(e, x, y);\r\n            }\r\n        } else {\r\n            if(this.selected != undefined){\r\n                let originalSelected = this.selected;\r\n                this.selected = selected;\r\n                this.onTouch(e, x, y, selected);\r\n                originalSelected.onMouseOut(e, x, y);\r\n            }\r\n            if(this.infinity && this.mousedown){\r\n                this.offsetX += x - this.originX;\r\n                this.offsetY += y - this.originY;\r\n                this.originX = x;\r\n                this.originY = y;\r\n                this.render();\r\n            }\r\n        }\r\n    }\r\n\r\n    _onMouseOver(e){\r\n        e.preventDefault();\r\n        let from = $(e.fromElement);\r\n        if(from.attr('handle') in this.elements){\r\n            return;\r\n        }\r\n        let x = e.pageX - this.canvas.offsetLeft;\r\n        let y = e.pageY - this.canvas.offsetTop;\r\n        this.onMouseOver(e, x, y);\r\n    }\r\n\r\n    _onMouseOut(e){\r\n        e.preventDefault();\r\n        let to = $(e.toElement);\r\n        if(to.attr('handle') in this.elements){\r\n            return;\r\n        }\r\n        let x = e.pageX - this.canvas.offsetLeft;\r\n        let y = e.pageY - this.canvas.offsetTop;\r\n        this._MouseUp();\r\n        this.onMouseOut(e, x, y);\r\n    }\r\n\r\n    // Elements Container Events\r\n\r\n    _onContainerMouseUp(e){\r\n        // http://stackoverflow.com/questions/13236484/mouseup-not-working-after-mousemove-on-img\r\n        e.preventDefault();\r\n        let element = $(e.target);\r\n        if(element.attr('handle') != undefined){\r\n            let box = this.elements[element.attr('handle')];\r\n            if(box != undefined){\r\n                let x = e.pageX - this.canvas.offsetLeft;\r\n                let y = e.pageY - this.canvas.offsetTop;\r\n                this.onMouseUp(e, x, y, box);\r\n                box.onMouseUp(e, x, y);\r\n            }\r\n        }\r\n    }\r\n\r\n    _onContainerMouseDown(e){\r\n        e.preventDefault();\r\n        let element = $(e.target);\r\n        if(element.attr('handle') != undefined){\r\n            let box = this.elements[element.attr('handle')];\r\n            if(box != undefined){\r\n                let x = e.pageX - this.canvas.offsetLeft;\r\n                let y = e.pageY - this.canvas.offsetTop;\r\n                this.onMouseDown(e, x, y, box);\r\n                box.onMouseDown(e, x, y);\r\n            }\r\n        }\r\n    }\r\n\r\n    _onContainerMouseOver(e){\r\n        e.preventDefault();\r\n        let element = $(e.target);\r\n        if(element.attr('handle') != undefined){\r\n            let box = this.elements[element.attr('handle')];\r\n            if(box != undefined){\r\n                let x = e.pageX - this.canvas.offsetLeft;\r\n                let y = e.pageY - this.canvas.offsetTop;\r\n                this.onTouch(e, x, y, box);\r\n                box.onMouseOver(e, x, y);\r\n                if(x > 0 && x < this.canvas.width &&\r\n                    y > 0 && y < this.canvas.height){\r\n                        this.onMouseOver(e, x, y);\r\n                    }\r\n            }\r\n        }\r\n    }\r\n\r\n    _onContainerMouseOut(e){\r\n        e.preventDefault();\r\n        let element = $(e.target);\r\n        if(element.attr('handle') != undefined){\r\n            let box = this.elements[element.attr('handle')];\r\n            if(box != undefined){\r\n                let x = e.pageX - this.canvas.offsetLeft;\r\n                let y = e.pageY - this.canvas.offsetTop;\r\n                this.onTouch(e, x, y, null);\r\n                box.onMouseOut(e, x, y);\r\n                if(x < 0 || x > this.canvas.width ||\r\n                    y < 0 || y > this.canvas.height){\r\n                        this._MouseUp();\r\n                        this.onMouseOut(e, x, y);\r\n                    }\r\n            }\r\n        }\r\n    }\r\n\r\n    // Public Methods\r\n\r\n    addBox(box, x, y, z){\r\n        let handle = box.handle = uuid.v1();\r\n        box.setPosition(x, y);\r\n        box.z = z || 0;\r\n        if(box.isElement){\r\n            this._addToDom(box);\r\n        } else {\r\n            this._addToLayer(box);\r\n            this.render();\r\n        }\r\n        box.scene = this;\r\n        box.mount = true;\r\n        return handle;\r\n    }\r\n\r\n    render(){\r\n        this.clear();\r\n        for(var i in this.layers){\r\n            let layer = this.layers[i];\r\n            _.forEach(layer, function(box, handle){\r\n                this._renderOne(box);\r\n            }.bind(this));\r\n        }\r\n        _.forEach(this.elements, function(element){\r\n            this._renderOne(element);\r\n        }.bind(this));\r\n    }\r\n\r\n    clear(){\r\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    }\r\n\r\n    // events\r\n\r\n    onMouseUp(e, x, y, box){\r\n        // override it\r\n    }\r\n\r\n    onMouseDown(e, x, y, box){\r\n        // override it\r\n    }\r\n\r\n    onMouseMove(e, x, y){\r\n        // override it\r\n    }\r\n\r\n    onMouseOver(e, x, y){\r\n        // override it\r\n    }\r\n\r\n    onMouseOut(e, x, y){\r\n        // override it\r\n    }\r\n\r\n    onTouch(e, x, y, box){\r\n        // override it\r\n    }\r\n\r\n}"]}