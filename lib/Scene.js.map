{"version":3,"sources":["../src/Scene.js"],"names":["Scene","id","canvas","document","getElementById","ctx","getContext","layers","reverseLayers","selected","onmouseup","_onMouseUp","bind","onmousedown","_onMouseDown","onmousemove","_onMouseMove","onmouseover","_onMouseOver","onmouseout","_onMouseOut","box","layer","z","undefined","handle","i","unshift","x","y","render","e","pageX","offsetLeft","pageY","offsetTop","isPointInPath","path","_onSelected","onMouseUp","onMouseDown","onMouseMove","onTouch","onMouseOver","onMouseOut","v1","setPosition","mount","_addToLayer","clear","forEach","_renderOne","clearRect","width","height"],"mappings":"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","file":"Scene.js","sourcesContent":["import _ from 'lodash';\nimport uuid from 'node-uuid';\n\nimport Context from './Context';\n\nexport default class Scene{\n    constructor(id){\n        this.canvas = document.getElementById(id);\n        this.ctx = this.canvas.getContext('2d');\n        this.layers = [];\n        this.reverseLayers = [];\n        this.selected = null;\n\n        this.canvas.onmouseup = this._onMouseUp.bind(this);\n        this.canvas.onmousedown = this._onMouseDown.bind(this);\n        this.canvas.onmousemove = this._onMouseMove.bind(this);\n\n        this.canvas.onmouseover = this._onMouseOver.bind(this);\n        this.canvas.onmouseout = this._onMouseOut.bind(this);\n    }\n\n    _addToLayer(box){\n        let layer = this.layers[box.z];\n        if(layer == undefined){\n            layer = {};\n            this.layers[box.z] = layer;\n        }\n        layer[box.handle] = box;\n        this.reverseLayers = [];\n        for(var i in this.layers){\n            this.reverseLayers.unshift(this.layers[i]);\n        }\n    }\n\n    _renderOne(box){\n        let ctx = new Context(this.ctx, box.x, box.y);\n        box.render(ctx);\n    }\n\n    _onSelected(e){\n        let x = e.pageX - this.canvas.offsetLeft;\n        let y = e.pageY - this.canvas.offsetTop;\n        let selected = null;\n        for(var i in this.reverseLayers){\n            let layer = this.reverseLayers[i];\n            for(var handle in layer){\n                let box = layer[handle];\n                if(this.ctx.isPointInPath(box.path, x, y)){\n                    selected = box;\n                    break;\n                }\n            }\n            if(selected != undefined){\n                break;\n            }\n        }\n        return selected;\n    }\n\n    _onMouseUp(e){\n        let selected = this._onSelected(e);\n        this.onMouseUp(e, selected);\n    }\n\n    _onMouseDown(e){\n        let selected = this._onSelected(e);\n        this.onMouseDown(e, selected);\n    }\n\n    _onMouseMove(e){\n        let x = e.pageX - this.canvas.offsetLeft;\n        let y = e.pageY - this.canvas.offsetTop;\n        this.onMouseMove(e, x, y);\n        let selected = this._onSelected(e);\n        if(selected != undefined){\n            if(this.selected == undefined || this.selected.handle != selected.handle){\n                this.selected = selected;\n                this.onTouch(e, selected);\n            }\n        } else {\n            if(this.selected != undefined){\n                this.selected = selected;\n                this.onTouch(e, selected);\n            }\n        }\n    }\n\n    _onMouseOver(e){\n        let x = e.pageX - this.canvas.offsetLeft;\n        let y = e.pageY - this.canvas.offsetTop;\n        this.onMouseOver(e, x, y);\n    }\n\n    _onMouseOut(e){\n        let x = e.pageX - this.canvas.offsetLeft;\n        let y = e.pageY - this.canvas.offsetTop;\n        this.onMouseOut(e, x, y);\n    }\n\n    addBox(box, x, y, z){\n        let handle = box.handle = uuid.v1();\n        box.setPosition(x, y);\n        box.z = z || 0;\n        box.mount = true;\n        this._addToLayer(box);\n        this.render();\n        return handle;\n    }\n\n    render(){\n        this.clear();\n        for(var i in this.layers){\n            let layer = this.layers[i];\n            _.forEach(layer, function(box, handle){\n                this._renderOne(box);\n            }.bind(this));\n        }\n    }\n\n    clear(){\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n\n    // events\n\n    onMouseUp(e, box){\n        // override it\n    }\n\n    onMouseDown(e, box){\n        // override it\n    }\n\n    onMouseMove(e, x, y){\n        // override it\n    }\n\n    onMouseOver(e, x, y){\n        // override it\n    }\n\n    onMouseOut(e, x, y){\n        // override it\n    }\n\n    onTouch(e, box){\n        // override it\n    }\n\n}"]}