{"version":3,"sources":["../src/Scene.js"],"names":["Scene","id","canvas","document","getElementById","ctx","getContext","layers","reverseLayers","selected","elementContainer","_initElementContainer","elements","onmouseup","_onMouseUp","bind","onmousedown","_onMouseDown","onmousemove","_onMouseMove","onmouseover","_onMouseOver","onmouseout","_onMouseOut","on","_onContainerMouseUp","_onContainerMouseDown","_onContainerMouseOver","_onContainerMouseOut","container","$","append","box","layer","z","undefined","handle","i","unshift","element","attr","css","x","offsetLeft","y","offsetTop","render","paths","_getPaths","_include","e","preventDefault","pageX","pageY","_onSelected","onMouseUp","onMouseDown","onMouseMove","onTouch","onMouseOver","originalSelected","onMouseOut","from","fromElement","to","toElement","target","v1","setPosition","isElement","_addToDom","_addToLayer","scene","mount","clear","forEach","_renderOne","clearRect","width","height"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AAEA;;;;;;;;IAEqBA,K;AACjB,mBAAYC,EAAZ,EAAe;AAAA;;AACX,aAAKC,MAAL,GAAcC,SAASC,cAAT,CAAwBH,EAAxB,CAAd;AACA,aAAKI,GAAL,GAAW,KAAKH,MAAL,CAAYI,UAAZ,CAAuB,IAAvB,CAAX;AACA,aAAKC,MAAL,GAAc,EAAd;AACA,aAAKC,aAAL,GAAqB,EAArB;AACA,aAAKC,QAAL,GAAgB,IAAhB;AACA,aAAKC,gBAAL,GAAwB,KAAKC,qBAAL,EAAxB;AACA,aAAKC,QAAL,GAAgB,EAAhB;;AAEA,aAAKV,MAAL,CAAYW,SAAZ,GAAwB,KAAKC,UAAL,CAAgBC,IAAhB,CAAqB,IAArB,CAAxB;AACA,aAAKb,MAAL,CAAYc,WAAZ,GAA0B,KAAKC,YAAL,CAAkBF,IAAlB,CAAuB,IAAvB,CAA1B;AACA,aAAKb,MAAL,CAAYgB,WAAZ,GAA0B,KAAKC,YAAL,CAAkBJ,IAAlB,CAAuB,IAAvB,CAA1B;AACA,aAAKb,MAAL,CAAYkB,WAAZ,GAA0B,KAAKC,YAAL,CAAkBN,IAAlB,CAAuB,IAAvB,CAA1B;AACA,aAAKb,MAAL,CAAYoB,UAAZ,GAAyB,KAAKC,WAAL,CAAiBR,IAAjB,CAAsB,IAAtB,CAAzB;;AAEA,aAAKL,gBAAL,CAAsBc,EAAtB,CAAyB,SAAzB,EAAoC,GAApC,EAAyC,KAAKC,mBAAL,CAAyBV,IAAzB,CAA8B,IAA9B,CAAzC;AACA,aAAKL,gBAAL,CAAsBc,EAAtB,CAAyB,WAAzB,EAAsC,GAAtC,EAA2C,KAAKE,qBAAL,CAA2BX,IAA3B,CAAgC,IAAhC,CAA3C;AACA,aAAKL,gBAAL,CAAsBc,EAAtB,CAAyB,WAAzB,EAAsC,GAAtC,EAA2C,KAAKL,YAAL,CAAkBJ,IAAlB,CAAuB,IAAvB,CAA3C;AACA,aAAKL,gBAAL,CAAsBc,EAAtB,CAAyB,WAAzB,EAAsC,GAAtC,EAA2C,KAAKG,qBAAL,CAA2BZ,IAA3B,CAAgC,IAAhC,CAA3C;AACA,aAAKL,gBAAL,CAAsBc,EAAtB,CAAyB,UAAzB,EAAqC,GAArC,EAA0C,KAAKI,oBAAL,CAA0Bb,IAA1B,CAA+B,IAA/B,CAA1C;AACH;;;;gDAEsB;AACnB,gBAAIc,YAAYC,EAAE,SAAF,CAAhB;AACAA,cAAE,MAAF,EAAUC,MAAV,CAAiBF,SAAjB;AACA,mBAAOA,SAAP;AACH;;;oCAEWG,G,EAAI;AACZ,gBAAIC,QAAQ,KAAK1B,MAAL,CAAYyB,IAAIE,CAAhB,CAAZ;AACA,gBAAGD,SAASE,SAAZ,EAAsB;AAClBF,wBAAQ,EAAR;AACA,qBAAK1B,MAAL,CAAYyB,IAAIE,CAAhB,IAAqBD,KAArB;AACH;AACDA,kBAAMD,IAAII,MAAV,IAAoBJ,GAApB;AACA,iBAAKxB,aAAL,GAAqB,EAArB;AACA,iBAAI,IAAI6B,CAAR,IAAa,KAAK9B,MAAlB,EAAyB;AACrB,qBAAKC,aAAL,CAAmB8B,OAAnB,CAA2B,KAAK/B,MAAL,CAAY8B,CAAZ,CAA3B;AACH;AACJ;;;kCAESL,G,EAAI;AACV,iBAAKpB,QAAL,CAAcoB,IAAII,MAAlB,IAA4BJ,GAA5B;AACAA,gBAAIO,OAAJ,CAAYC,IAAZ,CAAiB,QAAjB,EAA2BR,IAAII,MAA/B;AACAJ,gBAAIO,OAAJ,CAAYE,GAAZ,CAAgB,UAAhB,EAA4B,UAA5B;AACAT,gBAAIO,OAAJ,CAAYE,GAAZ,CAAgB,MAAhB,EAAwBT,IAAIU,CAAJ,GAAQ,KAAKxC,MAAL,CAAYyC,UAA5C;AACAX,gBAAIO,OAAJ,CAAYE,GAAZ,CAAgB,KAAhB,EAAuBT,IAAIY,CAAJ,GAAQ,KAAK1C,MAAL,CAAY2C,SAA3C;AACA,iBAAKnC,gBAAL,CAAsBqB,MAAtB,CAA6BC,IAAIO,OAAjC;AACH;;;mCAEUP,G,EAAI;AACX,gBAAI3B,MAAM,sBAAY,KAAKA,GAAjB,EAAsB2B,IAAIU,CAA1B,EAA6BV,IAAIY,CAAjC,CAAV;AACAZ,gBAAIc,MAAJ,CAAWzC,GAAX;AACA2B,gBAAIe,KAAJ,GAAY1C,IAAI2C,SAAJ,EAAZ;AACH;;;oCAEWN,C,EAAGE,C,EAAE;AACb,gBAAInC,WAAW,IAAf;AACA,iBAAI,IAAI4B,CAAR,IAAa,KAAK7B,aAAlB,EAAgC;AAC5B,oBAAIyB,QAAQ,KAAKzB,aAAL,CAAmB6B,CAAnB,CAAZ;AACA,qBAAI,IAAID,MAAR,IAAkBH,KAAlB,EAAwB;AACpB,wBAAID,MAAMC,MAAMG,MAAN,CAAV;AACA,wBAAGJ,IAAIiB,QAAJ,CAAaP,CAAb,EAAgBE,CAAhB,CAAH,EAAsB;AAClBnC,mCAAWuB,GAAX;AACA;AACH;AACJ;AACD,oBAAGvB,YAAY0B,SAAf,EAAyB;AACrB;AACH;AACJ;AACD,mBAAO1B,QAAP;AACH;;AAED;;;;mCAEWyC,C,EAAE;AACTA,cAAEC,cAAF;AACA,gBAAIT,IAAIQ,EAAEE,KAAF,GAAU,KAAKlD,MAAL,CAAYyC,UAA9B;AACA,gBAAIC,IAAIM,EAAEG,KAAF,GAAU,KAAKnD,MAAL,CAAY2C,SAA9B;AACA,gBAAIpC,WAAW,KAAK6C,WAAL,CAAiBZ,CAAjB,EAAoBE,CAApB,CAAf;AACA,gBAAGnC,YAAY0B,SAAf,EAAyB;AACrB1B,yBAAS8C,SAAT,CAAmBL,CAAnB,EAAsBR,CAAtB,EAAyBE,CAAzB;AACH;AACD,iBAAKW,SAAL,CAAeL,CAAf,EAAkBR,CAAlB,EAAqBE,CAArB,EAAwBnC,QAAxB;AACH;;;qCAEYyC,C,EAAE;AACXA,cAAEC,cAAF;AACA,gBAAIT,IAAIQ,EAAEE,KAAF,GAAU,KAAKlD,MAAL,CAAYyC,UAA9B;AACA,gBAAIC,IAAIM,EAAEG,KAAF,GAAU,KAAKnD,MAAL,CAAY2C,SAA9B;AACA,gBAAIpC,WAAW,KAAK6C,WAAL,CAAiBZ,CAAjB,EAAoBE,CAApB,CAAf;AACA,gBAAGnC,YAAY0B,SAAf,EAAyB;AACrB1B,yBAAS+C,WAAT,CAAqBN,CAArB,EAAwBR,CAAxB,EAA2BE,CAA3B;AACH;AACD,iBAAKY,WAAL,CAAiBN,CAAjB,EAAoBR,CAApB,EAAuBE,CAAvB,EAA0BnC,QAA1B;AACH;;;qCAEYyC,C,EAAE;AACXA,cAAEC,cAAF;AACA,gBAAIT,IAAIQ,EAAEE,KAAF,GAAU,KAAKlD,MAAL,CAAYyC,UAA9B;AACA,gBAAIC,IAAIM,EAAEG,KAAF,GAAU,KAAKnD,MAAL,CAAY2C,SAA9B;AACA,iBAAKY,WAAL,CAAiBP,CAAjB,EAAoBR,CAApB,EAAuBE,CAAvB;AACA,gBAAInC,WAAW,KAAK6C,WAAL,CAAiBZ,CAAjB,EAAoBE,CAApB,CAAf;AACA,gBAAGnC,YAAY0B,SAAf,EAAyB;AACrB,oBAAG,KAAK1B,QAAL,IAAiB0B,SAAjB,IAA8B,KAAK1B,QAAL,CAAc2B,MAAd,IAAwB3B,SAAS2B,MAAlE,EAAyE;AACrE,yBAAK3B,QAAL,GAAgBA,QAAhB;AACA,yBAAKiD,OAAL,CAAaR,CAAb,EAAgBR,CAAhB,EAAmBE,CAAnB,EAAsBnC,QAAtB;AACAA,6BAASkD,WAAT,CAAqBT,CAArB,EAAwBR,CAAxB,EAA2BE,CAA3B;AACH;AACJ,aAND,MAMO;AACH,oBAAG,KAAKnC,QAAL,IAAiB0B,SAApB,EAA8B;AAC1B,wBAAIyB,mBAAmB,KAAKnD,QAA5B;AACA,yBAAKA,QAAL,GAAgBA,QAAhB;AACA,yBAAKiD,OAAL,CAAaR,CAAb,EAAgBR,CAAhB,EAAmBE,CAAnB,EAAsBnC,QAAtB;AACAmD,qCAAiBC,UAAjB,CAA4BX,CAA5B,EAA+BR,CAA/B,EAAkCE,CAAlC;AACH;AACJ;AACJ;;;qCAEYM,C,EAAE;AACXA,cAAEC,cAAF;AACA,gBAAIW,OAAOhC,EAAEoB,EAAEa,WAAJ,CAAX;AACA,gBAAGD,KAAKtB,IAAL,CAAU,QAAV,KAAuB,KAAK5B,QAA/B,EAAwC;AACpC;AACH;AACD,gBAAI8B,IAAIQ,EAAEE,KAAF,GAAU,KAAKlD,MAAL,CAAYyC,UAA9B;AACA,gBAAIC,IAAIM,EAAEG,KAAF,GAAU,KAAKnD,MAAL,CAAY2C,SAA9B;AACA,iBAAKc,WAAL,CAAiBT,CAAjB,EAAoBR,CAApB,EAAuBE,CAAvB;AACH;;;oCAEWM,C,EAAE;AACVA,cAAEC,cAAF;AACA,gBAAIa,KAAKlC,EAAEoB,EAAEe,SAAJ,CAAT;AACA,gBAAGD,GAAGxB,IAAH,CAAQ,QAAR,KAAqB,KAAK5B,QAA7B,EAAsC;AAClC;AACH;AACD,gBAAI8B,IAAIQ,EAAEE,KAAF,GAAU,KAAKlD,MAAL,CAAYyC,UAA9B;AACA,gBAAIC,IAAIM,EAAEG,KAAF,GAAU,KAAKnD,MAAL,CAAY2C,SAA9B;AACA,iBAAKgB,UAAL,CAAgBX,CAAhB,EAAmBR,CAAnB,EAAsBE,CAAtB;AACH;;AAED;;;;4CAEoBM,C,EAAE;AAClB;AACAA,cAAEC,cAAF;AACA,gBAAIZ,UAAUT,EAAEoB,EAAEgB,MAAJ,CAAd;AACA,gBAAG3B,QAAQC,IAAR,CAAa,QAAb,KAA0BL,SAA7B,EAAuC;AACnC,oBAAIH,MAAM,KAAKpB,QAAL,CAAc2B,QAAQC,IAAR,CAAa,QAAb,CAAd,CAAV;AACA,oBAAGR,OAAOG,SAAV,EAAoB;AAChB,wBAAIO,IAAIQ,EAAEE,KAAF,GAAU,KAAKlD,MAAL,CAAYyC,UAA9B;AACA,wBAAIC,IAAIM,EAAEG,KAAF,GAAU,KAAKnD,MAAL,CAAY2C,SAA9B;AACA,yBAAKU,SAAL,CAAeL,CAAf,EAAkBR,CAAlB,EAAqBE,CAArB,EAAwBZ,GAAxB;AACAA,wBAAIuB,SAAJ,CAAcL,CAAd,EAAiBR,CAAjB,EAAoBE,CAApB;AACH;AACJ;AACJ;;;8CAEqBM,C,EAAE;AACpBA,cAAEC,cAAF;AACA,gBAAIZ,UAAUT,EAAEoB,EAAEgB,MAAJ,CAAd;AACA,gBAAG3B,QAAQC,IAAR,CAAa,QAAb,KAA0BL,SAA7B,EAAuC;AACnC,oBAAIH,MAAM,KAAKpB,QAAL,CAAc2B,QAAQC,IAAR,CAAa,QAAb,CAAd,CAAV;AACA,oBAAGR,OAAOG,SAAV,EAAoB;AAChB,wBAAIO,IAAIQ,EAAEE,KAAF,GAAU,KAAKlD,MAAL,CAAYyC,UAA9B;AACA,wBAAIC,IAAIM,EAAEG,KAAF,GAAU,KAAKnD,MAAL,CAAY2C,SAA9B;AACA,yBAAKW,WAAL,CAAiBN,CAAjB,EAAoBR,CAApB,EAAuBE,CAAvB,EAA0BZ,GAA1B;AACAA,wBAAIwB,WAAJ,CAAgBN,CAAhB,EAAmBR,CAAnB,EAAsBE,CAAtB;AACH;AACJ;AACJ;;;8CAEqBM,C,EAAE;AACpBA,cAAEC,cAAF;AACA,gBAAIZ,UAAUT,EAAEoB,EAAEgB,MAAJ,CAAd;AACA,gBAAG3B,QAAQC,IAAR,CAAa,QAAb,KAA0BL,SAA7B,EAAuC;AACnC,oBAAIH,MAAM,KAAKpB,QAAL,CAAc2B,QAAQC,IAAR,CAAa,QAAb,CAAd,CAAV;AACA,oBAAGR,OAAOG,SAAV,EAAoB;AAChB,wBAAIO,IAAIQ,EAAEE,KAAF,GAAU,KAAKlD,MAAL,CAAYyC,UAA9B;AACA,wBAAIC,IAAIM,EAAEG,KAAF,GAAU,KAAKnD,MAAL,CAAY2C,SAA9B;AACA,yBAAKa,OAAL,CAAaR,CAAb,EAAgBR,CAAhB,EAAmBE,CAAnB,EAAsBZ,GAAtB;AACAA,wBAAI2B,WAAJ,CAAgBT,CAAhB,EAAmBR,CAAnB,EAAsBE,CAAtB;AACH;AACJ;AACJ;;;6CAEoBM,C,EAAE;AACnBA,cAAEC,cAAF;AACA,gBAAIZ,UAAUT,EAAEoB,EAAEgB,MAAJ,CAAd;AACA,gBAAG3B,QAAQC,IAAR,CAAa,QAAb,KAA0BL,SAA7B,EAAuC;AACnC,oBAAIH,MAAM,KAAKpB,QAAL,CAAc2B,QAAQC,IAAR,CAAa,QAAb,CAAd,CAAV;AACA,oBAAGR,OAAOG,SAAV,EAAoB;AAChB,wBAAIO,IAAIQ,EAAEE,KAAF,GAAU,KAAKlD,MAAL,CAAYyC,UAA9B;AACA,wBAAIC,IAAIM,EAAEG,KAAF,GAAU,KAAKnD,MAAL,CAAY2C,SAA9B;AACA,yBAAKa,OAAL,CAAaR,CAAb,EAAgBR,CAAhB,EAAmBE,CAAnB,EAAsB,IAAtB;AACAZ,wBAAI6B,UAAJ,CAAeX,CAAf,EAAkBR,CAAlB,EAAqBE,CAArB;AACH;AACJ;AACJ;;AAED;;;;+BAEOZ,G,EAAKU,C,EAAGE,C,EAAGV,C,EAAE;AAChB,gBAAIE,SAASJ,IAAII,MAAJ,GAAa,mBAAK+B,EAAL,EAA1B;AACAnC,gBAAIoC,WAAJ,CAAgB1B,CAAhB,EAAmBE,CAAnB;AACAZ,gBAAIE,CAAJ,GAAQA,KAAK,CAAb;AACA,gBAAGF,IAAIqC,SAAP,EAAiB;AACb,qBAAKC,SAAL,CAAetC,GAAf;AACH,aAFD,MAEO;AACH,qBAAKuC,WAAL,CAAiBvC,GAAjB;AACA,qBAAKc,MAAL;AACH;AACDd,gBAAIwC,KAAJ,GAAY,IAAZ;AACAxC,gBAAIyC,KAAJ,GAAY,IAAZ;AACA,mBAAOrC,MAAP;AACH;;;iCAEO;AACJ,iBAAKsC,KAAL;AACA,iBAAI,IAAIrC,CAAR,IAAa,KAAK9B,MAAlB,EAAyB;AACrB,oBAAI0B,QAAQ,KAAK1B,MAAL,CAAY8B,CAAZ,CAAZ;AACA,iCAAEsC,OAAF,CAAU1C,KAAV,EAAiB,UAASD,GAAT,EAAcI,MAAd,EAAqB;AAClC,yBAAKwC,UAAL,CAAgB5C,GAAhB;AACH,iBAFgB,CAEfjB,IAFe,CAEV,IAFU,CAAjB;AAGH;AACJ;;;gCAEM;AACH,iBAAKV,GAAL,CAASwE,SAAT,CAAmB,CAAnB,EAAsB,CAAtB,EAAyB,KAAK3E,MAAL,CAAY4E,KAArC,EAA4C,KAAK5E,MAAL,CAAY6E,MAAxD;AACH;;AAED;;;;kCAEU7B,C,EAAGR,C,EAAGE,C,EAAGZ,G,EAAI;AACnB;AACH;;;oCAEWkB,C,EAAGR,C,EAAGE,C,EAAGZ,G,EAAI;AACrB;AACH;;;oCAEWkB,C,EAAGR,C,EAAGE,C,EAAE;AAChB;AACH;;;oCAEWM,C,EAAGR,C,EAAGE,C,EAAE;AAChB;AACH;;;mCAEUM,C,EAAGR,C,EAAGE,C,EAAE;AACf;AACH;;;gCAEOM,C,EAAGR,C,EAAGE,C,EAAGZ,G,EAAI;AACjB;AACH;;;;;;kBAjQgBhC,K","file":"Scene.js","sourcesContent":["import _ from 'lodash';\r\nimport uuid from 'node-uuid';\r\n\r\nimport Context from './Context';\r\n\r\nexport default class Scene{\r\n    constructor(id){\r\n        this.canvas = document.getElementById(id);\r\n        this.ctx = this.canvas.getContext('2d');\r\n        this.layers = [];\r\n        this.reverseLayers = [];\r\n        this.selected = null;\r\n        this.elementContainer = this._initElementContainer();\r\n        this.elements = {};\r\n\r\n        this.canvas.onmouseup = this._onMouseUp.bind(this);\r\n        this.canvas.onmousedown = this._onMouseDown.bind(this);\r\n        this.canvas.onmousemove = this._onMouseMove.bind(this);\r\n        this.canvas.onmouseover = this._onMouseOver.bind(this);\r\n        this.canvas.onmouseout = this._onMouseOut.bind(this);\r\n\r\n        this.elementContainer.on('mouseup', '*', this._onContainerMouseUp.bind(this));\r\n        this.elementContainer.on('mousedown', '*', this._onContainerMouseDown.bind(this));\r\n        this.elementContainer.on('mousemove', '*', this._onMouseMove.bind(this));\r\n        this.elementContainer.on('mouseover', '*', this._onContainerMouseOver.bind(this));\r\n        this.elementContainer.on('mouseout', '*', this._onContainerMouseOut.bind(this));\r\n    }\r\n\r\n    _initElementContainer(){\r\n        let container = $('<div />');\r\n        $('body').append(container);\r\n        return container;\r\n    }\r\n\r\n    _addToLayer(box){\r\n        let layer = this.layers[box.z];\r\n        if(layer == undefined){\r\n            layer = {};\r\n            this.layers[box.z] = layer;\r\n        }\r\n        layer[box.handle] = box;\r\n        this.reverseLayers = [];\r\n        for(var i in this.layers){\r\n            this.reverseLayers.unshift(this.layers[i]);\r\n        }\r\n    }\r\n\r\n    _addToDom(box){\r\n        this.elements[box.handle] = box;\r\n        box.element.attr('handle', box.handle);\r\n        box.element.css('position', 'absolute');\r\n        box.element.css('left', box.x + this.canvas.offsetLeft);\r\n        box.element.css('top', box.y + this.canvas.offsetTop);\r\n        this.elementContainer.append(box.element);\r\n    }\r\n\r\n    _renderOne(box){\r\n        let ctx = new Context(this.ctx, box.x, box.y);\r\n        box.render(ctx);\r\n        box.paths = ctx._getPaths();\r\n    }\r\n\r\n    _onSelected(x, y){\r\n        let selected = null;\r\n        for(var i in this.reverseLayers){\r\n            let layer = this.reverseLayers[i];\r\n            for(var handle in layer){\r\n                let box = layer[handle];\r\n                if(box._include(x, y)){\r\n                    selected = box;\r\n                    break;\r\n                }\r\n            }\r\n            if(selected != undefined){\r\n                break;\r\n            }\r\n        }\r\n        return selected;\r\n    }\r\n\r\n    // Canvas Events\r\n\r\n    _onMouseUp(e){\r\n        e.preventDefault();\r\n        let x = e.pageX - this.canvas.offsetLeft;\r\n        let y = e.pageY - this.canvas.offsetTop;\r\n        let selected = this._onSelected(x, y);\r\n        if(selected != undefined){\r\n            selected.onMouseUp(e, x, y);\r\n        }\r\n        this.onMouseUp(e, x, y, selected);\r\n    }\r\n\r\n    _onMouseDown(e){\r\n        e.preventDefault();\r\n        let x = e.pageX - this.canvas.offsetLeft;\r\n        let y = e.pageY - this.canvas.offsetTop;\r\n        let selected = this._onSelected(x, y);\r\n        if(selected != undefined){\r\n            selected.onMouseDown(e, x, y);\r\n        }\r\n        this.onMouseDown(e, x, y, selected);\r\n    }\r\n\r\n    _onMouseMove(e){\r\n        e.preventDefault();\r\n        let x = e.pageX - this.canvas.offsetLeft;\r\n        let y = e.pageY - this.canvas.offsetTop;\r\n        this.onMouseMove(e, x, y);\r\n        let selected = this._onSelected(x, y);\r\n        if(selected != undefined){\r\n            if(this.selected == undefined || this.selected.handle != selected.handle){\r\n                this.selected = selected;\r\n                this.onTouch(e, x, y, selected);\r\n                selected.onMouseOver(e, x, y);\r\n            }\r\n        } else {\r\n            if(this.selected != undefined){\r\n                let originalSelected = this.selected;\r\n                this.selected = selected;\r\n                this.onTouch(e, x, y, selected);\r\n                originalSelected.onMouseOut(e, x, y);\r\n            }\r\n        }\r\n    }\r\n\r\n    _onMouseOver(e){\r\n        e.preventDefault();\r\n        let from = $(e.fromElement);\r\n        if(from.attr('handle') in this.elements){\r\n            return;\r\n        }\r\n        let x = e.pageX - this.canvas.offsetLeft;\r\n        let y = e.pageY - this.canvas.offsetTop;\r\n        this.onMouseOver(e, x, y);\r\n    }\r\n\r\n    _onMouseOut(e){\r\n        e.preventDefault();\r\n        let to = $(e.toElement);\r\n        if(to.attr('handle') in this.elements){\r\n            return;\r\n        }\r\n        let x = e.pageX - this.canvas.offsetLeft;\r\n        let y = e.pageY - this.canvas.offsetTop;\r\n        this.onMouseOut(e, x, y);\r\n    }\r\n\r\n    // Elements Container Events\r\n\r\n    _onContainerMouseUp(e){\r\n        // http://stackoverflow.com/questions/13236484/mouseup-not-working-after-mousemove-on-img\r\n        e.preventDefault();\r\n        let element = $(e.target);\r\n        if(element.attr('handle') != undefined){\r\n            let box = this.elements[element.attr('handle')];\r\n            if(box != undefined){\r\n                let x = e.pageX - this.canvas.offsetLeft;\r\n                let y = e.pageY - this.canvas.offsetTop;\r\n                this.onMouseUp(e, x, y, box);\r\n                box.onMouseUp(e, x, y);\r\n            }\r\n        }\r\n    }\r\n\r\n    _onContainerMouseDown(e){\r\n        e.preventDefault();\r\n        let element = $(e.target);\r\n        if(element.attr('handle') != undefined){\r\n            let box = this.elements[element.attr('handle')];\r\n            if(box != undefined){\r\n                let x = e.pageX - this.canvas.offsetLeft;\r\n                let y = e.pageY - this.canvas.offsetTop;\r\n                this.onMouseDown(e, x, y, box);\r\n                box.onMouseDown(e, x, y);\r\n            }\r\n        }\r\n    }\r\n\r\n    _onContainerMouseOver(e){\r\n        e.preventDefault();\r\n        let element = $(e.target);\r\n        if(element.attr('handle') != undefined){\r\n            let box = this.elements[element.attr('handle')];\r\n            if(box != undefined){\r\n                let x = e.pageX - this.canvas.offsetLeft;\r\n                let y = e.pageY - this.canvas.offsetTop;\r\n                this.onTouch(e, x, y, box);\r\n                box.onMouseOver(e, x, y);\r\n            }\r\n        }\r\n    }\r\n\r\n    _onContainerMouseOut(e){\r\n        e.preventDefault();\r\n        let element = $(e.target);\r\n        if(element.attr('handle') != undefined){\r\n            let box = this.elements[element.attr('handle')];\r\n            if(box != undefined){\r\n                let x = e.pageX - this.canvas.offsetLeft;\r\n                let y = e.pageY - this.canvas.offsetTop;\r\n                this.onTouch(e, x, y, null);\r\n                box.onMouseOut(e, x, y);\r\n            }\r\n        }\r\n    }\r\n\r\n    // Public Methods\r\n\r\n    addBox(box, x, y, z){\r\n        let handle = box.handle = uuid.v1();\r\n        box.setPosition(x, y);\r\n        box.z = z || 0;\r\n        if(box.isElement){\r\n            this._addToDom(box);\r\n        } else {\r\n            this._addToLayer(box);\r\n            this.render();\r\n        }\r\n        box.scene = this;\r\n        box.mount = true;\r\n        return handle;\r\n    }\r\n\r\n    render(){\r\n        this.clear();\r\n        for(var i in this.layers){\r\n            let layer = this.layers[i];\r\n            _.forEach(layer, function(box, handle){\r\n                this._renderOne(box);\r\n            }.bind(this));\r\n        }\r\n    }\r\n\r\n    clear(){\r\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    }\r\n\r\n    // events\r\n\r\n    onMouseUp(e, x, y, box){\r\n        // override it\r\n    }\r\n\r\n    onMouseDown(e, x, y, box){\r\n        // override it\r\n    }\r\n\r\n    onMouseMove(e, x, y){\r\n        // override it\r\n    }\r\n\r\n    onMouseOver(e, x, y){\r\n        // override it\r\n    }\r\n\r\n    onMouseOut(e, x, y){\r\n        // override it\r\n    }\r\n\r\n    onTouch(e, x, y, box){\r\n        // override it\r\n    }\r\n\r\n}"]}